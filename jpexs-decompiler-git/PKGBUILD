# Maintainer: Yen Chi Hsuan <yan12125 at gmail dot com>

pkgname=jpexs-decompiler-git
_pkgname=jpexs-decompiler
pkgver=20141224
pkgrel=1
pkgdesc="Opensource flash SWF decompiler and editor"
arch=("any")
url="http://www.free-decompiler.com/flash/"
license=('GPL3')
makedepends=('git' 'apache-ant' 'java-environment=8')
depends=('java-runtime=8')
source=("${_pkgname}"::'git+https://github.com/jindrapetrik/jpexs-decompiler')
md5sums=('SKIP')

pkgver() {
    cd "${srcdir}/${_pkgname}"
    git log -1 --format='%cd' --date=short | tr -d -- '-'
}

prepare() {
    msg2 "Checking java compiler version"
    javac -version |& grep "1\.8" >& /dev/null || {
        msg2 "Current java compiler version is not 1.8! Run the following command as root: "
        msg2 "    archlinux-java set java-8-jdk"
        msg2 "Or"
        msg2 "    archlinux-java set java-8-openjdk"
        return 1
    }
    cd "${srcdir}/${_pkgname}"
    sed -i -e "s/ffdec\.jar/\/usr\/share\/java\/${_pkgname}\/ffdec\.jar/" \
           -e "/dirname/d" "resources/ffdec.sh"
}

build() {
    cd "${srcdir}/${_pkgname}"
    ant build
}

package() {
    cd "${srcdir}/${_pkgname}"
    install -Dm755 "resources/ffdec.sh" "${pkgdir}/usr/bin/ffdec"
    install -Ddm755 "${pkgdir}/usr/share/java/${_pkgname}"
    for f in dist/* ; do
        cp -dr --no-preserve=ownership "$f" "${pkgdir}/usr/share/java/${_pkgname}"
    done
    install -Dm644 "license.txt" "${pkgdir}/usr/share/licenses/${_pkgname}/license.txt"
}
